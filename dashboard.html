<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Auteur - LiaRead</title>
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: #f5f0ff;
  color: #3d2c8d;
  margin: 0;
  padding: 0;
}
header {
  background-color: #5a3e9a;
  color: white;
  padding: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
header h1 { margin:0; font-size:24px; }
header button {
  background-color: white;
  color: #5a3e9a;
  border: none;
  padding: 8px 15px;
  border-radius: 20px;
  cursor: pointer;
  font-weight: bold;
}
header button:hover { background-color: #e0d4f7; }
section { padding: 20px; }
.submit-section, .books-section, .earnings-section { margin-bottom:30px; }
.submit-section form {
  display:flex; flex-direction:column; max-width:400px;
}
.submit-section input, .submit-section button {
  margin-bottom:10px; padding:10px; border-radius:15px; border:1px solid #ccc; font-size:16px;
}
.submit-section button {
  background-color:#5a3e9a; color:white; border:none; cursor:pointer; font-weight:bold;
}
.submit-section button:hover { background-color:#4b3280; }
#booksList { display:flex; flex-wrap:wrap; gap:15px; }
.book-card {
  background-color:white; border-radius:15px; padding:10px; width:200px; box-shadow:0 0 5px rgba(0,0,0,0.1);
}
.book-card img { width:100%; border-radius:10px; }
footer {
  background-color:#5a3e9a; color:white; padding:15px; text-align:center;
}
footer a { color:#f5f0ff; text-decoration:none; font-weight:bold; }
footer a:hover { text-decoration:underline; }
.earnings-section p { font-size:18px; font-weight:bold; }
</style>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage.js"></script>
<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@2.6.4/dist/email.min.js"></script>
</head>
<body>

<header>
  <h1>Dashboard Auteur</h1>
  <button id="logoutBtn">Se Déconnecter</button>
</header>

<section class="submit-section">
  <h2>Soumettre un nouveau livre</h2>
  <form id="bookForm">
    <input type="text" id="title" placeholder="Titre du livre" required>
    <input type="text" id="category" placeholder="Catégorie" required>
    <input type="number" id="price" placeholder="Prix (F)" required>
    <input type="file" id="cover" accept="image/*" required>
    <input type="file" id="file" accept=".pdf,.epub" required>
    <button type="submit">Soumettre</button>
  </form>
</section>

<section class="books-section">
  <h2>Mes livres soumis</h2>
  <div id="booksList"></div>
</section>

<section class="earnings-section">
  <h2>Mes gains</h2>
  <p id="earnings">0 F</p>
</section>

<footer>
  <p>Contactez l'équipe :</p>
  <p>
    <a href="mailto:agodthanks@gmail.com">Email</a> | 
    <a href="https://wa.me/2290199616039" target="_blank">WhatsApp</a>
  </p>
</footer>

<script>
// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyDpaf3wdXkypPKH443SIZcJRFiz02s-t30",
    authDomain: "liaread.firebaseapp.com",
    projectId: "liaread",
    storageBucket: "liaread.appspot.com",
    messagingSenderId: "951394019167",
    appId: "1:951394019167:web:86825d5ebff4d77807f8ea"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

// Initialize EmailJS
emailjs.init("YOUR_PUBLIC_KEY");

// Logout
document.getElementById('logoutBtn').addEventListener('click', () => {
    auth.signOut().then(()=>{
        alert("Vous êtes déconnecté !");
        window.location.href = "signup.html";
    });
});

// Vérifier connexion
auth.onAuthStateChanged(user => {
    if(!user) window.location.href="signup.html";
    else loadBooks();
});

// Soumission livre
const bookForm = document.getElementById('bookForm');
bookForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const title = document.getElementById('title').value;
    const category = document.getElementById('category').value;
    const price = parseFloat(document.getElementById('price').value);
    const coverFile = document.getElementById('cover').files[0];
    const bookFile = document.getElementById('file').files[0];
    const user = auth.currentUser;
    if(!user) return alert("Veuillez vous connecter.");

    try {
        // Upload cover
        const coverRef = storage.ref(`covers/${Date.now()}_${coverFile.name}`);
        await coverRef.put(coverFile);
        const coverURL = await coverRef.getDownloadURL();

        // Upload book
        const bookRef = storage.ref(`books/${Date.now()}_${bookFile.name}`);
        await bookRef.put(bookFile);
        const bookURL = await bookRef.getDownloadURL();

        // Add book to Firestore
        await db.collection('books').add({
            title, category, price, coverURL, bookURL, authorId:user.uid, createdAt:Date.now()
        });

        alert("Livre soumis avec succès !");

        // Email notification
        emailjs.send("YOUR_SERVICE_ID","YOUR_TEMPLATE_ID",{
            author_email: user.email,
            title: title
        }).then(()=>console.log("Email envoyé"));

        bookForm.reset();
        loadBooks();

    } catch(err) { console.error(err); alert("Erreur lors de la soumission."); }
});

// Charger livres
async function loadBooks(){
    const user = auth.currentUser;
    const booksList = document.getElementById('booksList');
    booksList.innerHTML="";
    let totalEarnings = 0;

    const snapshot = await db.collection('books').where('authorId','==',user.uid).orderBy('createdAt','desc').get();
    snapshot.forEach(doc=>{
        const book = doc.data();
        totalEarnings += book.price || 0;
        const div = document.createElement('div');
        div.classList.add('book-card');
        div.innerHTML = `<img src="${book.coverURL}" alt="${book.title}"><h3>${book.title}</h3><p>${book.category}</p><p>${book.price} F</p>`;
        booksList.appendChild(div);
    });

    document.getElementById('earnings').innerText = totalEarnings + " F";
}
</script>
</body>
</html>
