<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LiaRead</title>
  <link rel="stylesheet" href="style.css"><!-- laissé volontairement : styles externes OK, nos styles locaux ont priorité -->

  <!-- SDK Fedapay (inchangé) -->
  <script src="https://checkout.fedapay.com/fedapay-checkout.js"></script>

  <!-- SDK Firebase (compat - inchangé) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <!-- Styles internes (prioritaires pour éviter interférence externe) -->
  <style>
    :root{
      --purple:#4b0082;
      --purple-dark:#360061;
      --muted:#666;
      --card-bg:#fff;
      --glass: rgba(255,255,255,0.85);
    }

    /* Reset/box-sizing */
    *,*::before,*::after{box-sizing:border-box}

    body{
      margin:0;
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: linear-gradient(180deg,#fbf8ff 0%, #f3f3fb 100%);
      color:#222;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.3;
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      padding:18px;
      background:var(--purple);
      color:#fff;
    }

    /* Brand / Lia stylisé (compte de fées) */
    .brand-block{display:flex;flex-direction:column;gap:6px}
    .lia-name{
      font-family: "Brush Script MT", "Segoe Script", cursive;
      font-size:34px;
      letter-spacing:1px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:8px;
      text-shadow: 0 2px 6px rgba(75,0,130,0.25);
    }
    .lia-name .lia-accent{
      color: #ffdd66;
      font-size:20px;
      transform:rotate(-15deg);
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.15));
    }
    .welcome-text{
      font-size:13px;
      color: #fff;
      opacity:0.95;
      font-style:italic;
      max-width:520px;
    }

    /* dots menu */
    .menu-dots{position:relative}
    #dotsBtn{
      background:transparent;
      color:#fff;
      border:none;
      font-size:28px;
      cursor:pointer;
      width:48px;height:48px;border-radius:50%;
      display:flex;align-items:center;justify-content:center;
      transition: background .15s;
    }
    #dotsBtn:hover{ background: rgba(255,255,255,0.08) }
    .dots-dropdown{
      position:absolute;
      right:0;
      top:56px;
      background:var(--card-bg);
      color:#222;
      border-radius:10px;
      box-shadow:0 8px 30px rgba(38,0,38,0.12);
      min-width:200px;
      padding:8px 6px;
      display:flex;
      flex-direction:column;
      gap:6px;
      z-index:1200;
      transform-origin: top right;
      transition: transform .12s ease, opacity .12s ease;
    }
    .dots-dropdown[aria-hidden="true"]{ opacity:0; transform: scale(.98); pointer-events:none }
    .dots-dropdown[aria-hidden="false"]{ opacity:1; transform: scale(1); pointer-events:auto }

    .dots-dropdown a{
      display:block;
      padding:10px 12px;
      color:var(--purple);
      text-decoration:none;
      border-radius:8px;
      font-weight:700;
    }
    .dots-dropdown a:hover{ background: rgba(75,0,130,0.06) }

    /* search */
    .search-section{padding:14px 18px; background:transparent}
    #search{
      width:100%;
      max-width:720px;
      padding:12px 14px;
      border-radius:10px;
      border:1px solid #e6dff3;
      box-shadow: 0 6px 18px rgba(75,0,130,0.04);
      font-size:15px;
    }

    /* categories */
    .categories{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      padding:12px 18px;
    }
    .categories button{
      background:var(--glass);
      border:1px solid rgba(75,0,130,0.06);
      padding:8px 12px;
      border-radius:999px;
      cursor:pointer;
      font-weight:700;
      color:var(--purple);
    }
    .categories button:hover{ transform: translateY(-2px); box-shadow: 0 8px 18px rgba(75,0,130,0.06) }

    /* sections */
    .section-block{ padding:12px 18px; }
    .section-title{
      font-family: "Brush Script MT", cursive;
      color:var(--purple);
      font-size:20px;
      margin:6px 0 12px;
    }

    /* books grid: responsive with fixed item size 160x360 */
    .books-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap:14px;
    }

    .book{
      width:100%;
      max-width:160px;
      height:360px;
      background:var(--card-bg);
      border-radius:12px;
      box-shadow: 0 6px 18px rgba(38,0,38,0.06);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
      align-items:stretch;
      transition: transform .15s ease, box-shadow .15s ease;
      margin:0 auto;
    }
    .book:hover{ transform: translateY(-6px); box-shadow: 0 12px 30px rgba(38,0,38,0.12) }

    .cover-wrap{ width:100%; height:220px; overflow:hidden; background:#f6f3fb; display:flex; align-items:center; justify-content:center; }
    .cover{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .book-body{
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
      flex:1;
    }
    .book-body h3{
      margin:0;
      font-size:16px;
      color:var(--purple);
      font-family: "Brush Script MT", cursive;
      line-height:1.1;
    }
    .book-body .author{ font-size:12px; color:var(--muted); margin:0; }
    .price{ font-size:13px; color:#444; font-weight:700; margin:0; }

    .card-actions{
      margin-top:auto;
      display:flex;
      gap:8px;
      align-items:center;
    }
    .fedapay-button{
      flex:1;
      background:linear-gradient(180deg,var(--purple),var(--purple-dark));
      color:#fff;
      border:none;
      padding:8px;
      border-radius:8px;
      cursor:pointer;
      font-weight:800;
      font-size:13px;
    }
    .fedapay-button:hover{ opacity:0.95 }

    /* popup overlay (dynamic) */
    .popup-overlay{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,0.45);
      z-index:2000;
      padding:20px;
    }
    .popup-card{
      width:100%;
      max-width:720px;
      background:var(--card-bg);
      padding:18px;
      border-radius:12px;
      box-shadow:0 12px 40px rgba(38,0,38,0.16);
      position:relative;
      animation: popupIn .16s ease;
    }
    @keyframes popupIn{ from{ transform: translateY(8px); opacity:0 } to{ transform:translateY(0); opacity:1 } }
    .popup-close{
      position:absolute;
      right:12px; top:12px;
      background:transparent; border:none; font-size:18px; cursor:pointer; color:var(--muted);
    }

    /* mobile tweaks */
    @media (max-width:560px){
      .lia-name{ font-size:26px }
      .welcome-text{ font-size:12px }
      .book{ max-width:46vw; height:320px }
      .cover-wrap{ height:190px }
      .books-grid{ gap:10px }
    }
  </style>
</head>
<body>

<header>
  <div class="brand-block">
    <div class="lia-name" onclick="location.href='index.html'">
      Lia <span class="lia-accent">✧</span>
    </div>
    <div class="welcome-text">Bienvenue dans l'univers Lia — des histoires qui réchauffent le cœur ✨</div>
  </div>

  <div class="menu-dots" id="menuDots" aria-haspopup="true" aria-expanded="false" title="Menu">
    <button id="dotsBtn" aria-label="Ouvrir menu">…</button>
    <div id="dotsDropdown" class="dots-dropdown" role="menu" aria-hidden="true">
      <a href="signup.html" role="menuitem">Créer un compte auteur</a>
      <a href="dashboard.html" role="menuitem">Mon compte</a>
      <a href="mailto:myliaread@gmail.com" role="menuitem">Aide</a>
      <a href="best.sellers.html" role="menuitem">Lire</a>
      <a href="all.livres.html" role="menuitem">Tous les livres</a>
    </div>
  </div>
</header>

<section class="search-section">
  <input type="text" id="search" placeholder="Rechercher un livre...">
</section>

<section class="categories" aria-label="Catégories">
  <button data-cat="all">Tous</button>
  <button data-cat="roman">Roman</button>
  <button data-cat="romantique">Romantique</button>
  <button data-cat="milliardaire">Milliardaire</button>
  <button data-cat="nouvelle">Nouvelle</button>
  <button data-cat="conte">Conte</button>
  <button data-cat="vampire-loup">Vampire/Loup-Garou</button>
  <button data-cat="bd">BD</button>
  <button data-cat="aventure">Aventure</button>
  <button data-cat="bien-etre">Bien-être</button>
  <button data-cat="fantastique">Fantastique</button>
</section>

<!-- POPULAIRE -->
<section class="section-block">
  <h2 class="section-title">Populaire</h2>
  <div class="books-grid" id="popularBooks">
    <!-- Aime moi (first, as requested) -->
    <div class="book" data-cat="roman">
      <div class="cover-wrap">
        <img src="couverture_aime-moi.jpg" alt="Couverture — Aime moi" class="cover">
      </div>
      <div class="book-body">
        <h3>Aime moi</h3>
        <p class="price">2500 XOF</p>
        <div class="card-actions">
          <button class="fedapay-button" data-link="https://me.fedapay.com/56clJ3ZK">Acheter</button>
          <button class="fedapay-button popup-opener" data-popup="popup-aime-moi">Extrait</button>
        </div>
      </div>
    </div>

    <!-- L'amour voir clair -->
    <div class="book" data-cat="romantique">
      <div class="cover-wrap">
        <img src="couverture_l'amourvoitclair_2.jpg" alt="Couverture — L'amour voit clair" class="cover">
      </div>
      <div class="book-body">
        <h3>L'amour voit clair</h3>
        <p class="price">1500 XOF</p>
        <div class="card-actions">
          <button class="fedapay-button" data-link="#">Acheter</button>
          <button class="fedapay-button popup-opener" data-popup="popup-l'amour_voit_clair">Extrait</button>
        </div>
      </div>
    </div>

    <!-- add any other books you had in your original code here (kept order) -->
  </div>
</section>

<!-- DECOUVERTE -->
<section class="section-block">
  <h2 class="section-title">Découverte</h2>
  <div class="books-grid" id="discoverBooks">
    <div class="book" data-cat="fantastique">
      <div class="cover-wrap">
        <img src="couverture_magie-noire.jpg" alt="Couverture — Magie Noire" class="cover">
      </div>
      <div class="book-body">
        <h3>Magie Noire</h3>
        <p class="price">3500 XOF</p>
        <div class="card-actions">
          <button class="fedapay-button" data-link="#">Acheter</button>
          <button class="fedapay-button popup-opener" data-popup="popup-magie-noire">Extrait</button>
        </div>
      </div>
    </div>

    <div class="book" data-cat="aventure">
      <div class="cover-wrap">
        <img src="couverture_explorateurs.jpg" alt="Couverture — Explorateurs du Temps" class="cover">
      </div>
      <div class="book-body">
        <h3>Explorateurs du Temps</h3>
        <p class="price">4000 XOF</p>
        <div class="card-actions">
          <button class="fedapay-button" data-link="#">Acheter</button>
          <button class="fedapay-button popup-opener" data-popup="popup-explorateurs">Extrait</button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- NOUVEAU -->
<section class="section-block">
  <h2 class="section-title">Nouveau</h2>
  <div class="books-grid" id="newBooks">
    <!-- intentionally left empty for now -->
    <!-- Example placeholders (kept original but you can remove) -->
    <div class="book" data-cat="roman" aria-hidden="true" style="display:none"></div>
  </div>
</section>

<footer>
  <p>Email: <a href="mailto:myliaread@gmail.com">myliaread@gmail.com</a></p>
  <p>WhatsApp: <a href="https://wa.me/2290147244055" target="_blank">+2290147244055</a></p>
</footer>

<!-- Scripts -->
<script>
  // === Firebase config (compat) - left unchanged ===
  const firebaseConfig = {
    apiKey: "AIzaSyDpaf3wdXkypPKH443SIZcJRFiz02s-t30",
    authDomain: "liaread.firebaseapp.com",
    projectId: "liaread",
    storageBucket: "liaread.firebasestorage.app",
    messagingSenderId: "951394019167",
    appId: "1:951394019167:web:86825d5ebff4d77807f8ea",
    measurementId: "G-63JN91LVV6"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  // === Categories filter (works across all sections) ===
  const catButtons = document.querySelectorAll('.categories button');
  const allBooks = document.querySelectorAll('.book');

  catButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const cat = btn.dataset.cat;
      allBooks.forEach(book => {
        if (cat === 'all' || book.dataset.cat === cat) {
          book.style.display = '';
        } else {
          book.style.display = 'none';
        }
      });
    });
  });

  // === Search across visible titles ===
  const searchInput = document.getElementById('search');
  searchInput.addEventListener('input', () => {
    const value = searchInput.value.toLowerCase();
    allBooks.forEach(book => {
      const titleEl = book.querySelector('h3');
      const title = titleEl ? titleEl.textContent.toLowerCase() : '';
      if (!value || title.includes(value)) book.style.display = '';
      else book.style.display = 'none';
    });
  });

  // === Fedapay buttons ===
  document.querySelectorAll('.fedapay-button').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const link = btn.dataset.link;
      // If btn has popup data attribute, let popup handler manage it
      if (btn.classList.contains('popup-opener')) return;
      if (link && link !== '#') {
        window.open(link, '_blank');
      } else {
        alert('Lien de paiement non défini.');
      }
    });
  });

  // === Dots menu ===
  const dotsBtn = document.getElementById('dotsBtn');
  const dotsDropdown = document.getElementById('dotsDropdown');

  dotsBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    const hidden = dotsDropdown.getAttribute('aria-hidden') === 'true';
    dotsDropdown.setAttribute('aria-hidden', hidden ? 'false' : 'true');
    document.getElementById('menuDots').setAttribute('aria-expanded', hidden ? 'true' : 'false');
  });

  document.addEventListener('click', () => {
    dotsDropdown.setAttribute('aria-hidden', 'true');
    document.getElementById('menuDots').setAttribute('aria-expanded', 'false');
  });

  // === Load popups from external file (popups.html) and show ===
  let popupsDoc = null;
  async function loadPopupsDoc() {
    if (popupsDoc) return popupsDoc;
    try {
      const res = await fetch('popups.html', {cache: "no-store"});
      const text = await res.text();
      const parser = new DOMParser();
      popupsDoc = parser.parseFromString(text, 'text/html');
      return popupsDoc;
    } catch (err) {
      alert('Impossible de charger les popups : ' + err.message);
      throw err;
    }
  }

  async function showPopupFromTemplate(templateId) {
    try {
      const doc = await loadPopupsDoc();
      const tpl = doc.getElementById(templateId);
      if (!tpl) {
        alert('Popup introuvable : ' + templateId);
        return;
      }
      const clone = tpl.content.cloneNode(true);
      const overlay = document.createElement('div');
      overlay.className = 'popup-overlay';
      overlay.appendChild(clone);

      const closeBtn = overlay.querySelector('.popup-close');
      if (closeBtn) closeBtn.addEventListener('click', () => overlay.remove());
      overlay.addEventListener('click', (e) => { if (e.target === overlay) overlay.remove(); });

      document.body.appendChild(overlay);
    } catch (err) {
      console.error(err);
    }
  }

  // attach handlers to popup-opener buttons
  document.querySelectorAll('.popup-opener').forEach(btn => {
    btn.addEventListener('click', () => {
      const popupId = btn.dataset.popup;
      if (popupId) showPopupFromTemplate(popupId);
    });
  });

  // Accessibility: close overlay with Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      document.querySelectorAll('.popup-overlay').forEach(o => o.remove());
    }
  });
</script>
</body>
    </html>
